@{
    Layout = Context.Request.Headers["HX-Request"] == "true" ? null : "_Layout";
}

@model AccountDtoForCreation
<div id="dataHolder" data-section="@Model.SectionId"></div>
<div class="form-container">
    <div class="form-header">
        <a href="javascript:void(0)" onclick="history.back()" hx-target="#content" hx-push-url="true" class="back-btn">
            <i class="fas fa-arrow-left"></i>Geri
        </a>
        <h1><i class="fas fa-user-plus"></i> Kullanıcı Ekleme</h1>
        <p>Yeni kullanıcı bilgilerini eksiksiz olarak doldurunuz</p>
    </div>

    <div class="form-body">
        <div id="login-errors" class="text-danger validation-summary-errors" asp-validation-summary="All"></div>
        <form method="post" id="internForm" class="hxform validation" hx-post="/Company/AddUser" hx-target="#content">
            @Html.AntiForgeryToken()
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label" asp-for="FirstName">
                        <i class="fas fa-user"></i>Ad
                    </label>
                    <input type="text" class="form-control" hx-on:focus="handleInputFocus(event);" hx-on:blur="handleInputBlur(event);" asp-for="FirstName" placeholder="Adınızı giriniz"/>
                    <span asp-validation-for="FirstName" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label class="form-label" asp-for="LastName">
                        <i class="fas fa-user"></i>Soyad
                    </label>
                    <input type="text" class="form-control" hx-on:focus="handleInputFocus(event);" hx-on:blur="handleInputBlur(event);" asp-for="LastName" placeholder="Soyadınızı giriniz" />
                    <span asp-validation-for="LastName" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label class="form-label" asp-for="Email">
                        <i class="fas fa-envelope"></i>E-Posta Adresi
                    </label>
                    <input type="email" class="form-control" hx-on:focus="handleInputFocus(event);" hx-on:blur="handleInputBlur(event);" asp-for="Email" placeholder="ornek@email.com" />
                    <span asp-validation-for="Email" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label class="form-label" asp-for="PhoneNumber">
                        <i class="fas fa-phone"></i>Telefon Numarası
                    </label>
                    <input type="tel" class="form-control" hx-on:focus="handleInputFocus(event);" hx-on:blur="handleInputBlur(event);" asp-for="PhoneNumber" placeholder="0555 555 55 55" />
                    <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label class="form-label" asp-for="UserName">
                        <i class="fas fa-at"></i>Kullanıcı No
                    </label>
                    <input type="text" class="form-control" hx-on:focus="handleInputFocus(event);" hx-on:blur="handleInputBlur(event);" asp-for="UserName" value="@Model.UserName" readonly />
                    <span asp-validation-for="UserName" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label class="form-label" asp-for="Password">
                        <i class="fas fa-lock"></i>Şifre
                    </label>
                    <input type="password" class="form-control" hx-on:focus="handleInputFocus(event);" hx-on:blur="handleInputBlur(event);" asp-for="Password" placeholder="••••••••" />
                    <span asp-validation-for="Password" class="text-danger"></span>
                </div>
            </div>

            <div class="form-group full-width">
                <label class="form-label">
                    <i class="fas fa-building"></i>Departman ve Bölüm Seçimi
                </label>

                <div class="section-selection">
                    <div class="department-section">
                        <div class="section-title">
                            <i class="fas fa-sitemap"></i>Departman Seçiniz
                        </div>
                        <select hx-on:change="departmentSelectHandler(event);" asp-for="DepartmentId" class="form-control" id="departmentSelect" name="DepartmentId" required>
                            <option value="">Departman seçiniz...</option>
                            @foreach (var department in ViewBag.Departments)
                            {
                                <option value="@department.DepartmentId">@department.DepartmentName</option>
                            }
                        </select>
                        <span asp-validation-for="DepartmentId" class="text-danger"></span>
                    </div>

                    <div id="sectionsContainer" style="display: none;">
                        <div class="section-title">
                            <i class="fas fa-users"></i>Bölüm Seçiniz
                        </div>
                        <div class="sections-grid" id="sectionsGrid">
                        </div>
                        <div class="helper-text">
                            <i class="fas fa-info-circle"></i>Kullanıcının bölümünü seçiniz.
                        </div>
                    </div>
                </div>
                <span asp-validation-for="SectionId" class="text-danger"></span>
            </div>

            <div class="form-roles-section">
                <div class="form-roles-title">
                    <i class="fas fa-shield-alt me-2"></i>Kullanıcı Rolleri
                </div>

                @foreach (var item in Model.Roles)
                {
                    <div class="form-role-item">
                        <input type="checkbox" name="Roles" value="@item" class="form-check-input" id="role-@item"/>
                        <label class="form-check-label" for="role-@item">@item</label>
                    </div>
                }

                <div class="form-helper-text">
                    <i class="fas fa-info-circle me-1"></i>Kullanıcı için uygun rolleri seçiniz.
                </div>
            </div>

            <button type="submit" hx-on:click="handleFormSubmit();" class="form-submit-btn" id="submitBtn">
                <i class="fas fa-user-plus"></i> Kullanıcı Oluştur
            </button>
        </form>
    </div>
</div>

<script>
    window.departmentSections = @Html.Raw(ViewBag.DepartmentSectionsJson ?? "{}");
</script>
<script asp-append-version="true" src="~/js/addintern.js"></script>