@model MessageDtoForCreation

@{
    Layout = Context.Request.Headers["HX-Request"] == "true" ? null : "_Layout";
}

<div class="form-container" hx-on::load="initAddMessageScripts();">
    <div class="form-header">
        <a href="/Messages/Index" hx-get="/Messages/Index" hx-target="#content" hx-push-url="true" class="back-btn">
            <i class="fas fa-arrow-left"></i>Geri
        </a>
        <h1><i class="fas fa-user-plus"></i> Mesaj Ekleme</h1>
        <p>Yeni mesaj bilgilerini eksiksiz olarak doldurunuz</p>
    </div>
    <div class="form-body">
        <div id="login-errors" class="text-danger validation-summary-errors" asp-validation-summary="All"></div>
        <form method="post" id="messageForm" class="hxform validation messageAddForm" hx-push-url="false" hx-post="/Messages/AddMessage" hx-target="#content">
            @Html.AntiForgeryToken()

            <div class="form-grid">
                <div class="form-group full-width">
                    <label class="form-label" asp-for="MessageTitle">
                        <i class="fas fa-user"></i>Mesaj Başlığı
                    </label>
                    <input type="text" class="form-control" hx-on:focus="handleInputFocus(event);" hx-on:blur="handleInputBlur(event);" asp-for="MessageTitle" placeholder="Mesaj başlığını giriniz" />
                    <span asp-validation-for="MessageTitle" class="text-danger"></span>
                </div>
            </div>

            <div class="form-group full-width">
                <div class="form-group full-width">
                    <label class="form-label" asp-for="MessageBody">
                        <i class="fas fa-user"></i>Mesaj İçeriği
                    </label>
                    <textarea class="form-control description" hx-on:focus="handleInputFocus(event);" hx-on:blur="handleInputBlur(event);" asp-for="MessageBody" style="resize:none;" placeholder="Mesaj içeriğini giriniz"></textarea>
                    <span asp-validation-for="MessageBody" class="text-danger"></span>
                </div>
            </div>

            <div class="broadcast-section">
                <div class="broadcast-title">
                    <i class="fas fa-bullhorn"></i>
                    Gönderim Seçenekleri
                </div>

                <div class="broadcast-options">
                    <div class="broadcast-option">
                        <input type="radio" id="broadcast-all" name="broadcast" class="broadcast-radio" value="All">
                        <label for="broadcast-all" class="broadcast-label">
                            <div class="radio-icon"></div>
                            <div class="broadcast-label-text">
                                <div class="broadcast-label-title">Herkese Gönder</div>
                                <div class="broadcast-label-desc">Tüm kullanıcılara gönderilir</div>
                            </div>
                        </label>
                    </div>

                    <div class="broadcast-option">
                        <input type="radio" id="broadcast-users" name="broadcast" class="broadcast-radio" value="Users">
                        <label for="broadcast-users" class="broadcast-label">
                            <div class="radio-icon"></div>
                            <div class="broadcast-label-text">
                                <div class="broadcast-label-title">Seçili Kullanıcılar</div>
                                <div class="broadcast-label-desc">Sadece seçilen kişilere gönderilir</div>
                            </div>
                        </label>
                    </div>

                    <div class="broadcast-option">
                        <input type="radio" id="broadcast-department" name="broadcast" class="broadcast-radio" value="Department">
                        <label for="broadcast-department" class="broadcast-label">
                            <div class="radio-icon"></div>
                            <div class="broadcast-label-text">
                                <div class="broadcast-label-title">Seçili Departman</div>
                                <div class="broadcast-label-desc">Sadece seçilen departmandakilere gönderilir</div>
                            </div>
                        </label>
                    </div>

                    <div class="broadcast-option">
                        <input type="radio" id="broadcast-section" name="broadcast" class="broadcast-radio" value="Section">
                        <label for="broadcast-section" class="broadcast-label">
                            <div class="radio-icon"></div>
                            <div class="broadcast-label-text">
                                <div class="broadcast-label-title">Seçili Bölüm</div>
                                <div class="broadcast-label-desc">Sadece seçilen bölümdekilere gönderilir</div>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <div class="user-search-section">
                <div class="user-search-title">
                    <i class="fas fa-users"></i>
                    Kullanıcı Ara
                </div>

                <div class="user-search-container">
                    <input type="text" class="user-search-input" placeholder="Kullanıcı adı veya e-posta ile ara..." id="user-search">
                    <i class="fas fa-search search-icon"></i>

                    <div class="user-search-results" id="search-results">
                    </div>

                    <div class="selected-users" id="selected-users">
                    </div>
                </div>
            </div>

            <div class="form-group full-width select-section">
                <label class="form-label">
                    <i class="fas fa-building"></i>Departman ve Bölüm Seçimi
                </label>

                <div class="section-selection">
                    <div class="department-section">
                        <div class="section-title">
                            <i class="fas fa-sitemap"></i>Departman Seçiniz
                        </div>
                        <select hx-on:change="departmentSelectHandler(event);" class="form-control" id="departmentSelect" name="DepartmentId">
                            <option value="">Departman seçiniz...</option>
                            @foreach (var department in ViewBag.Departments)
                            {
                                <option value="@department.DepartmentId">@department.DepartmentName</option>
                            }
                        </select>
                        <span class="text-danger"></span>
                    </div>

                    <div id="sectionsContainer" style="display: none;">
                        <div class="section-title">
                            <i class="fas fa-users"></i>Bölüm Seçiniz
                        </div>
                        <div class="sections-grid" id="sectionsGrid">
                        </div>
                        <div class="helper-text">
                            <i class="fas fa-info-circle"></i>Kullanıcının bölümünü seçiniz.
                        </div>
                    </div>
                </div>
                <span class="text-danger"></span>
            </div>

            <div id="hidden-inputs-container"></div>

            <button class="form-submit-btn" id="submitBtn">
                <i class="fas fa-user-plus"></i> Mesaj Oluştur
            </button>
        </form>
    </div>
</div>

<script>
    window.departmentSections = @Html.Raw(ViewBag.DepartmentSectionsJson ?? "{}");
</script>
<script src="~/js/addmessage.js" asp-append-version="true"></script>

